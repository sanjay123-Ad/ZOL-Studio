name: Monthly Credit Reset

on:
  schedule:
    # Run daily at midnight UTC (00:00 UTC)
    # This will trigger the monthly credit reset for users whose next_credit_reset_at is due
    - cron: '0 0 * * *'
  workflow_dispatch:  # Allow manual trigger from GitHub Actions UI

jobs:
  reset-credits:
    runs-on: ubuntu-latest
    name: Reset Monthly Credits
    
    steps:
      - name: Call Credit Reset Endpoint
        run: |
          curl -L -X POST ${{ secrets.VERCEL_CREDIT_RESET_URL }} \
            -H "x-reset-secret: ${{ secrets.CREDIT_RESET_SECRET }}" \
            -H "Content-Type: application/json" \
            -w "\nHTTP Status: %{http_code}\n"
        
      - name: Display Result
        if: always()
        run: |
          echo "âœ… Credit reset job completed"
          echo "Check your Vercel function logs for details"

